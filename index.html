<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Le√≥n vs Impala ‚Äî Simulador Q-Learning (PRO)</title>

    <!-- Estilos PRO -->
    <link rel="stylesheet" href="css/styles.css">
</head>

<!-- Tema inicial -->
<body data-theme="dark">

<header>
    <h1>Simulador: Le√≥n aprende a cazar un Impala</h1>
    <p class="subtitle">Dashboard interactivo ‚Äî Q-Learning, visualizaci√≥n y an√°lisis</p>

    <!-- Toggle de tema -->
    <div class="theme-toggle" id="themeToggle">
        Cambiar a modo claro/oscuro üåó
    </div>
</header>

<main class="layout">

    <!-- =======================================
         IZQUIERDA ‚Äî SIMULADOR (Canvas + Controles)
         ======================================= -->
    <section class="left">

        <div class="main-visual-area">

            <!-- Canvas -->
            <div class="canvas-container">
                <canvas id="board" width="510" height="510"></canvas>
            </div>

            <!-- Controles -->
            <div class="controls">

                <label>
                    Posici√≥n inicial del le√≥n:
                    <select id="startPos">
                        <option value="1">1 (N)</option>
                        <option value="2">2 (NE)</option>
                        <option value="3">3 (E)</option>
                        <option value="4">4 (SE)</option>
                        <option value="5">5 (S)</option>
                        <option value="6">6 (SW)</option>
                        <option value="7">7 (W)</option>
                        <option value="8">8 (NW)</option>
                        <option value="rand" selected>Aleatoria</option>
                    </select>
                </label>

                <label>
                    Modo del Impala:
                    <select id="impalaMode">
                        <option value="aleatorio" selected>Aleatorio</option>
                        <option value="programado">Programado (secuencia)</option>
                    </select>
                </label>

                <label id="progLabel" style="display:none">
                    Secuencia (coma separada):
                    <input id="progSeq" placeholder="ver_frente,ver_izq,beber,...">
                </label>

                <div class="btnrow">
                    <button id="btnReset">Reset</button>
                    <button id="btnStep">Siguiente T</button>
                    <button id="btnRun">Ejecutar</button>
                    <button id="btnTrain">Entrenar √ó1000</button>
                    <button id="btnStopTrain" style="display:none">Detener</button>
                </div>

            </div>

        </div>
<!-- Heatmap controls (pegar dentro de .controls) -->
<label>
  Mostrar Heatmap:
  <button id="btnToggleHeatmap" type="button">Mostrar</button>
</label>

<label>
  Acci√≥n (heatmap por acci√≥n):
  <select id="heatmapAction">
    <option value="__max__">Mejor acci√≥n (max)</option>
    <option value="avanzar">avanzar</option>
    <option value="esconder">esconder</option>
    <option value="atacar">atacar</option>
    <option value="esperar">esperar</option>
  </select>
</label>

    </section>

    <!-- =======================================
         DERECHA ‚Äî PANEL DE INFORMACI√ìN (PRO)
         ======================================= -->
    <section class="right">

        <!-- Estado actual -->
        <h2>üìä Estado Actual</h2>
        <div class="stats">
            <p>Turno: <span id="turn">--</span></p>
            <p>Estado: <span id="status">--</span></p>
            <p>Acci√≥n Impala anterior: <span id="lastImpala">--</span></p>
            <p>Acci√≥n Le√≥n anterior: <span id="lastLion">--</span></p>
        </div>

        <hr>

        <!-- Q-Table -->
        <button class="collapsible">üß† Q-Table (Base de Conocimiento)</button>
        <div class="content-collapsible">

            <div class="kbControls">
                <button id="btnShowKB">Mostrar/Actualizar</button>
                <button id="btnExplain">Explicar decisi√≥n</button>
            </div>

            <div class="kbControls">
                <button id="btnSaveKB">Guardar Q-Table</button>
                <button id="btnLoadKB">Cargar Q-Table</button>
                <input type="file" id="kbFile" style="display:none">
            </div>

            <pre id="kbView"></pre>
        </div>

        <hr>

        <!-- Log -->
        <button class="collapsible">üìú Registro de Eventos</button>
        <div class="content-collapsible">
            <div class="kbControls">
                <button id="btnClearLog">Limpiar Log</button>
            </div>

            <div id="log"></div>
        </div>

    </section>

</main>

<!-- =======================================================
     SCRIPTS (Simulador y UI PRO)
     ======================================================= -->

<!-- L√≥gica del entorno -->
<script src="js/env.js"></script>
<script src="js/impala.js"></script>
<script src="js/leon.js"></script>
<script src="js/qlearning.js"></script>
<script src="js/knowledge.js"></script>
<script src="js/ui.js"></script>
<script src="js/main.js"></script>

<!-- =======================================
     SCRIPT PRO: Toggle de tema + Paneles colapsables
     ======================================= -->
<script>
/* ---------- üåó Toggle Dark/Light Mode ---------- */
const toggleBtn = document.getElementById("themeToggle");
toggleBtn.onclick = () => {
    const body = document.body;
    const current = body.getAttribute("data-theme");
    const next = current === "dark" ? "light" : "dark";
    body.setAttribute("data-theme", next);
    toggleBtn.textContent = "Cambiar a modo claro/oscuro üåó";
};

/* ---------- üì¶ Paneles colapsables ---------- */
document.querySelectorAll(".collapsible").forEach(btn => {
    btn.addEventListener("click", () => {
        btn.classList.toggle("active");
        const content = btn.nextElementSibling;
        content.style.display = (content.style.display === "block") ? "none" : "block";
    });
});

/* ---------- üßΩ Limpiar log ---------- */
document.getElementById("btnClearLog")?.addEventListener("click", () => {
    document.getElementById("log").innerHTML = "";
});
</script>

</body>
</html>
